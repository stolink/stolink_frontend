name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  ai_review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write

    steps:
      - uses: actions/checkout@v4

      - name: Code Review with Claude
        uses: anthropics/claude-code-action@main # Using main as specific version tag not found
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          trigger_phrase: "AI 리뷰"
          prompt: |
            You are an expert code reviewer acting as a senior software engineer for "Sto-Link", a story management platform.

            **Project Context:**
            - We are building a complex web app managing Stories, Foreshadowing, and Character Relationships.
            - Prioritize **TypeScript type safety** and **Zustand state management efficiency**.
            - Always consider compatibility with existing data structures (Project, Chapter, etc.) when suggesting changes.

            **Review Guidelines:**
            1. Focus on **critical logic errors** and **performance issues**.
            2. Be **concise and direct**. Skip unnecessary praise or fluff.
            3. Provide **improved code examples** immediately.
            4. **Language**: Provide all feedback in **Korean**.

            Please review the changes in this Pull Request following these rules.
